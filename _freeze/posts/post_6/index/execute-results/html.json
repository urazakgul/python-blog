{
  "hash": "70d73ce4659da2cfdc10aaf7b4e80e4a",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"İstanbul İlçe Belediye Başkanlarının X (Twitter) Profillerindeki Duygu Dağılımı\"\nauthor: \"Uraz Akgül\"\ndate: \"2024-04-13\"\n# date-modified: last-modified\ndate-format: \"MMMM D, YYYY\"\ncategories: [Yüz, Duygu Analizi]\nimage: \"imgs/emotions_heatmap.png\"\nexecute:\n  eval: false\n---\n\nYapılan çalışmaların yanında içinde profil fotoğrafının da olduğu sosyal medya kullanımı da önemli olabiliyor.\n\nBu uygulamada, İstanbul ilçe belediye başkanlarının X (Twitter) profillerindeki duygularını inceleyeceğiz. Duyguların tespitinde `Py-Feat` kütüphanesinden faydalanacağız.\n\n**Kullanılacak Kütüphaneler**\n\n::: {#1b35eb13 .cell execution_count=1}\n``` {.python .cell-code}\nimport os\nimport pandas as pd\nfrom feat import Detector\nfrom feat.plotting import imshow\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n```\n:::\n\n\n**Fotoğrafların İçe Aktarılması**\n\n[Buradan](https://github.com/urazakgul/python-blog/tree/main/posts/post_6){.external target=\"_blank\"} ulaşabileceğiniz fotoğraflar ilçe belediye başkanlarının X (Twitter) hesaplarından indirilmiştir.\n\n::: {#5d84aa83 .cell execution_count=2}\n``` {.python .cell-code}\nimage_folder = 'ilce_bb_profil/'\nimage_files = [f for f in os.listdir(image_folder) if f.endswith('.jpg')]\n```\n:::\n\n\n**Duyguların Tespit Edilmesi ve Görselleştirilmesi**\n\n`Py-Feat`, görüntülerden ve videolardan yüz ifadelerini kolayca tespit etmek, yüz ifadesi verilerini önceden işlemek ve analiz etmek ve yüz ifadesi verilerini görselleştirmek için kapsamlı bir araç ve model seti sağlar. `Py-Feat` önceden eğitilmiş çeşitli modelleri içeriyor.\n\n::: {#beead13b .cell execution_count=3}\n``` {.python .cell-code}\ndetector = Detector(\n    face_model='retinaface', # face detection\n    landmark_model='mobilefacenet', # facial landmark detection\n    facepose_model='img2pose', # facial pose estimation\n    au_model='xgb', # action unit detection\n    emotion_model='resmasknet', # emotion detection\n)\n```\n:::\n\n\n* Yüz tespiti (Face detection, `face_model`): Bir görüntüdeki veya bir videodaki insan yüzlerini algılama sürecidir. Yüz tespiti, bir görüntü içindeki yüz bölgelerini belirlemek için kullanılır. Parametre seçenekleri şunlardır: `retinaface`, `mtcnn`, `faceboxes`, `img2pose` ve `img2pose-c`.\n\n* Yüz belirleme (Facial landmark detection, `landmark_model`): Yüzün belirli noktalarını (örneğin, gözler, burun, ağız) tespit etme sürecidir. Bu noktalar genellikle gözbebekleri, burun ucundaki nokta, dudakların kenarları gibi önemli anatomik yerlerdir. Parametre seçenekleri şunlardır: `mobilefacenet`, `mobilenet` ve `pfld`.\n\n* Yüz poz tahmini (Facial Pose estimation, `facepose_model`): Bir yüzün konumunu ve/veya dönüşünü belirleme sürecidir. Yüzün kaç derece eğik olduğunu, hangi yönde baktığını tahmin etmeyi içerir. Parametre seçenekleri şunlardır: `img2pose` ve `img2pose-c`.\n\n* Hareket Birimi tespiti (Action Unit detection, `au_model`): Yüz ifadelerindeki belirli kas gruplarını temsil eden hareket birimlerini (action units) tanımlama sürecidir. Örneğin, kaşların kaldırılması, dudakların büzülmesi gibi. Parametre seçenekleri şunlardır: `xgb` ve `svm`.\n\n* Duygu tespiti (Emotion detection, `emotion_model`): Bir kişinin yüz ifadesinden duygusal durumunu belirleme sürecidir. Örneğin, mutlu, üzgün, kızgın gibi duyguları tanımlama. Parametre seçenekleri şunlardır: `resmasknet` ve `svm`.\n\nBir döngü ile tüm fotoğrafları dahil edeceğiz ama öncesinde örnek bir fotoğraf ile sürece bakalım.\n\n::: {#16edf03f .cell execution_count=4}\n``` {.python .cell-code}\nexample_img = 'uskudar_chp.jpg'\nimshow(image_folder + example_img)\n```\n:::\n\n\n![](ilce_bb_profil/uskudar_chp.jpg)\n\n`detect_image()` ile yüklenen modelleri kullanalım.\n\n::: {#50b1d23a .cell execution_count=5}\n``` {.python .cell-code}\nsingle_face_prediction = detector.detect_image(image_folder + example_img)\n```\n:::\n\n\n![](imgs/single_face_prediction.PNG)\n\nBuradan duyguları çekelim.\n\n::: {#c851400d .cell execution_count=6}\n``` {.python .cell-code}\nemotions = single_face_prediction.emotions\n```\n:::\n\n\n![](imgs/emotions.PNG)\n\n`Py-Feat` görselleştirme imkanı da sunuyor. Bunu iki farklı şekilde yapabiliriz.\n\n::: {#fca140d5 .cell execution_count=7}\n``` {.python .cell-code}\nfigs = single_face_prediction.plot_detections(poses=True)\n```\n:::\n\n\n![](imgs/emotions_plot_1.png)\n\n::: {#114ca572 .cell execution_count=8}\n``` {.python .cell-code}\nfigs = single_face_prediction.plot_detections(faces='aus', muscles=True)\n```\n:::\n\n\n![](imgs/emotions_plot_2.png)\n\nTüm fotoğraflar için duyguları tespit edelim. Görseli ısı haritası ile yapacağız.\n\nÖncesinde `image_files` değişkenine tüm fotoğrafları aktarmıştık. Bunu kullanabiliriz.\n\n::: {#2a020ce6 .cell execution_count=9}\n``` {.python .cell-code}\nemotions_df = pd.DataFrame()\n\nfor image_file in image_files:\n    face_prediction = detector.detect_image(image_folder + image_file)\n    face_prediction_final = face_prediction[face_prediction['FaceScore'] == face_prediction['FaceScore'].max()]\n    emotions = face_prediction_final.emotions\n    ilce, parti = image_file.split('_')\n    parti = parti.split('.')[0]\n    emotions['image_file'] = ilce.upper() + '-' + parti.upper()\n    emotions_df = pd.concat([emotions_df, emotions], ignore_index=True)\n\nemotions_df = emotions_df.set_index('image_file')\nemotions_df.columns = emotions_df.columns.str.upper()\n```\n:::\n\n\nDöngüde bulunan `face_prediction_final` değişkenini birden fazla yüz tespiti olduğu için oluşturdum. Büyükçekmece belediye başkanının profilinde kedi de bulunmaktadır.\n\n::: {#05d7f702 .cell execution_count=10}\n``` {.python .cell-code}\nexample_img = 'buyukcekmece_chp.jpg'\nimshow(image_folder + example_img)\n```\n:::\n\n\n![](ilce_bb_profil/buyukcekmece_chp.jpg)\n\nIsı haritası ile duyguları gösterebiliriz.\n\n::: {#3b591f1f .cell execution_count=11}\n``` {.python .cell-code}\nplt.figure(figsize=(10, 12))\nsns.heatmap(emotions_df, cmap='Reds', annot=False, linewidths=.5)\nplt.title('İstanbul İlçe Belediye Başkanları X (Twitter) Profilleri Duygu Dağılımı')\nplt.tick_params(left=False, bottom=False)\nplt.ylabel('')\nplt.show()\n```\n:::\n\n\n![](imgs/emotions_heatmap.png)\n\nProfil fotoğraflarında doğal olarak en güçlü duygunun `happiness` olduğunu görüyoruz. `neutral` pozlar da kendini göstermektedir.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}