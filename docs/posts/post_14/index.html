<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="tr" xml:lang="tr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Uraz Akgül">

<title>Python Blog - İndikatör Ağırlıklarının Optimize Edilerek Teknik Reytinglerin Oluşturulması ve Al-Tut Stratejisinin Alt Edilmesi</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sonuç yok",
    "search-matching-documents-text": "eşleşen belgeler",
    "search-copy-link-title": "Aramak için bağlantıyı kopyalayın",
    "search-hide-matches-text": "Ek eşleşmeleri gizle",
    "search-more-match-text": "bu belgede daha fazla eşleşme",
    "search-more-matches-text": "bu belgede daha fazla eşleşmeler",
    "search-clear-button-title": "Temizle",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "İptal et",
    "search-submit-button-title": "Göndermek",
    "search-label": "Aramak"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Python Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Aramak"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Gezinmeyi değiştir" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Ana Sayfa</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Yazılar</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-paketler" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Paketler</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-paketler">    
        <li>
    <a class="dropdown-item" href="https://github.com/urazakgul/isyatirimhisse" target="_blank">
 <span class="dropdown-text">isyatirimhisse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/urazakgul/EIAOpenData" target="_blank">
 <span class="dropdown-text">EIAOpenData</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Karanlık modu değiştir"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">İndikatör Ağırlıklarının Optimize Edilerek Teknik Reytinglerin Oluşturulması ve Al-Tut Stratejisinin Alt Edilmesi</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Teknik Analiz</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      <div>
      <div class="quarto-title-meta-heading">Yazar</div>
      <div class="quarto-title-meta-contents">
               <p>Uraz Akgül </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Yayınlanma Tarihi</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Mayıs 25, 2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Değiştirilmiş</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">Mayıs 25, 2024</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Bu sayfada</h2>
   
  <ul>
  <li><a href="#giriş" id="toc-giriş" class="nav-link active" data-scroll-target="#giriş">Giriş</a></li>
  <li><a href="#kullanılacak-kütüphaneler" id="toc-kullanılacak-kütüphaneler" class="nav-link" data-scroll-target="#kullanılacak-kütüphaneler">Kullanılacak Kütüphaneler</a></li>
  <li><a href="#veri-setinin-oluşturulması" id="toc-veri-setinin-oluşturulması" class="nav-link" data-scroll-target="#veri-setinin-oluşturulması">Veri Setinin Oluşturulması</a></li>
  <li><a href="#hesaplama" id="toc-hesaplama" class="nav-link" data-scroll-target="#hesaplama">Hesaplama</a>
  <ul class="collapse">
  <li><a href="#kümülatif-getiri" id="toc-kümülatif-getiri" class="nav-link" data-scroll-target="#kümülatif-getiri">Kümülatif Getiri</a></li>
  <li><a href="#hesaplamanın-tasarımı" id="toc-hesaplamanın-tasarımı" class="nav-link" data-scroll-target="#hesaplamanın-tasarımı">Hesaplamanın Tasarımı</a></li>
  <li><a href="#indikatörlerin-hesaplanması" id="toc-indikatörlerin-hesaplanması" class="nav-link" data-scroll-target="#indikatörlerin-hesaplanması">İndikatörlerin Hesaplanması</a>
  <ul class="collapse">
  <li><a href="#sinyallerin-güncellenmesi" id="toc-sinyallerin-güncellenmesi" class="nav-link" data-scroll-target="#sinyallerin-güncellenmesi">Sinyallerin Güncellenmesi</a></li>
  <li><a href="#indikatörlerin-optimize-edilmesinde-genel-yaklaşım" id="toc-indikatörlerin-optimize-edilmesinde-genel-yaklaşım" class="nav-link" data-scroll-target="#indikatörlerin-optimize-edilmesinde-genel-yaklaşım">İndikatörlerin Optimize Edilmesinde Genel Yaklaşım</a></li>
  <li><a href="#indikatörlerin-optimize-edilmesi" id="toc-indikatörlerin-optimize-edilmesi" class="nav-link" data-scroll-target="#indikatörlerin-optimize-edilmesi">İndikatörlerin Optimize Edilmesi</a></li>
  </ul></li>
  <li><a href="#reytinglerin-hesaplanması" id="toc-reytinglerin-hesaplanması" class="nav-link" data-scroll-target="#reytinglerin-hesaplanması">Reytinglerin Hesaplanması</a>
  <ul class="collapse">
  <li><a href="#pandas-dataframein-güncellenmesi" id="toc-pandas-dataframein-güncellenmesi" class="nav-link" data-scroll-target="#pandas-dataframein-güncellenmesi">Pandas DataFrame’in Güncellenmesi</a></li>
  <li><a href="#indikatör-listesinin-oluşturulması" id="toc-indikatör-listesinin-oluşturulması" class="nav-link" data-scroll-target="#indikatör-listesinin-oluşturulması">İndikatör Listesinin Oluşturulması</a></li>
  <li><a href="#reyting-aralığının-oluşturulması" id="toc-reyting-aralığının-oluşturulması" class="nav-link" data-scroll-target="#reyting-aralığının-oluşturulması">Reyting Aralığının Oluşturulması</a></li>
  <li><a href="#indikatör-ağırlıklarının-optimize-edilmesi" id="toc-indikatör-ağırlıklarının-optimize-edilmesi" class="nav-link" data-scroll-target="#indikatör-ağırlıklarının-optimize-edilmesi">İndikatör Ağırlıklarının Optimize Edilmesi</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="giriş" class="level1">
<h1>Giriş</h1>
<p>Tradingview platformundaki tanıma göre teknik reytingler, <em>işlemcinin ve yatırımcıların karlı işlemler bulmasını kolaylaştırmak için çeşitli teknik göstergelerin derecelendirmelerini birleştiren teknik bir analiz aracıdır</em> şeklindedir. Örneğin, BTC-USD’nin teknik reytingi aşağıdaki gibidir.</p>
<p><img src="imgs/img_1.PNG" class="img-fluid"></p>
<p>Oluşturacağımız teknik reytinglerin mantığı Tradingview platformundaki gibi olsa da bazı değişiklikler yapacağız. Bu değişiklikleri aşağıdaki gibi özetleyebiliriz.</p>
<ul>
<li>İndikatörlerin seçilmesi: Tradingview platformunda kullanılan indikatörlerden farklılaşacağız. Bu noktada, yatırımcı kendi indikatörlerini seçebilir.</li>
<li>Stratejilerin oluşturulması: Her bir indikatör için bir alım-satım stratejisi belirleyeceğiz. Bu noktada, yatırımcı kendi alım-satım stratejilerini belirleyebilir.</li>
<li>Stratejide kullanılacak değerlerin optimize edilmesi: Tarihsel verileri kullanarak ilgili indikatöre ait alım-satım stratejisinde kullanılacak değerlerden en iyi kümülatif getiri sağlayanları kullanacağız.</li>
<li>Reytinglerin oluşturulmasında ağırlıkların optimize edilmesi: Alım-satım kararında her indikatöre eşit ağırlık vermek yerine en iyi kümülatif getiri performansı gösteren ağırlık dağılımını kullanacağız.</li>
</ul>
<p>Çalışmada, tüm etkilerin sıfır varsayıldığının ve sadece getiriye odaklanıldığının altını çizelim. Ayrıca bu çalışma, aktif bir şekilde alım-satım stratejisi takip etmenin al-tut stratejisini her zaman yenebileceğini iddia etmemektedir.</p>
</section>
<section id="kullanılacak-kütüphaneler" class="level1">
<h1>Kullanılacak Kütüphaneler</h1>
<div id="e241c6cd" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ta <span class="im">import</span> trend, momentum, volatility</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="veri-setinin-oluşturulması" class="level1">
<h1>Veri Setinin Oluşturulması</h1>
<div id="f554e863" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> yf.download(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    tickers<span class="op">=</span><span class="st">'BTC-USD'</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    start<span class="op">=</span><span class="st">'2018-01-01'</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    interval<span class="op">=</span><span class="st">'1d'</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="va">False</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'Adj Close'</span> <span class="kw">in</span> df.columns:</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.drop(columns<span class="op">=</span><span class="st">'Close'</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.rename(columns<span class="op">=</span>{<span class="st">'Adj Close'</span>: <span class="st">'Close'</span>})</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="hesaplama" class="level1">
<h1>Hesaplama</h1>
<section id="kümülatif-getiri" class="level2">
<h2 class="anchored" data-anchor-id="kümülatif-getiri">Kümülatif Getiri</h2>
<p>Çalışmada kullanacağımız kümülatif getiri, tüm değerleme dönemi boyunca bileşik günlük getiriyi verir ve aşağıdaki gibi formülize edilebilir.</p>
<p><span class="math inline">\(R_c = \prod_{i=1}^{n} (1 + R_i) - 1 = (1 + R_1)(1 + R_2)...(1 + R_n) - 1\)</span></p>
<p>Bir örnek ile nasıl hesaplandığına bakalım.</p>
<div id="63a27e36" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Veri</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Date'</span>: pd.date_range(start<span class="op">=</span><span class="st">'2024-05-20'</span>, periods<span class="op">=</span><span class="dv">5</span>, freq<span class="op">=</span><span class="st">'D'</span>),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Prices'</span>: [<span class="dv">100</span>, <span class="dv">101</span>, <span class="fl">100.5</span>, <span class="fl">102.5</span>, <span class="fl">101.3</span>]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>data_df <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Getiri</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>data_df[<span class="st">'Return'</span>] <span class="op">=</span> data_df[<span class="st">'Prices'</span>].pct_change()</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Kümülatif Getiri</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>data_df[<span class="st">'Cumulative Return'</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> data_df[<span class="st">'Return'</span>]).cumprod() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>cumulative_return <span class="op">=</span> data_df[<span class="st">'Cumulative Return'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cumulative Return: </span><span class="sc">{</span>cumulative_return<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Başlangıç Değer Değişimi</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>initial_value <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>final_value <span class="op">=</span> initial_value <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> cumulative_return)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final Value: </span><span class="sc">{</span>final_value<span class="sc">:.2f}</span><span class="ss"> TL"</span>)</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="hesaplamanın-tasarımı" class="level2">
<h2 class="anchored" data-anchor-id="hesaplamanın-tasarımı">Hesaplamanın Tasarımı</h2>
<p>Popüler bir teknik analiz kütüphanesi olan <code>ta</code> kütüphanesini ve aşağıdaki trend, momentum ve volatilite indikatörlerini kullanacağız.</p>
<ul>
<li>Trend
<ul>
<li>Weighted Moving Average: <code>WMAIndicator</code></li>
<li>Moving Average Convergence Divergence: <code>MACD</code></li>
<li>Average Directional Movement Index: <code>ADXIndicator</code></li>
<li>Ichimoku Kinkō Hyō: <code>IchimokuIndicator</code></li>
</ul></li>
<li>Momentum
<ul>
<li>Relative Strength Index: <code>RSIIndicator</code></li>
<li>Rate of Change: <code>ROCIndicator</code></li>
</ul></li>
<li>Volatilite
<ul>
<li>Bollinger Bands: <code>BollingerBands</code></li>
</ul></li>
</ul>
<p>Her bir indikatörde al sinyallerine 1, sat sinyallerine -1 ve nötr sinyallerine 0 atayacağız. Tüm optimizasyon işlemleri bittikten sonra aşağıdaki kriterleri baz alarak alım-satım kararını uygulayacağız.</p>
<ul>
<li>-1.0 <span class="math inline">\(\leq\)</span> reyting <span class="math inline">\(\leq\)</span> -0.5 ise Sat</li>
<li>-0.5 <span class="math inline">\(&lt;\)</span> reyting <span class="math inline">\(&lt;\)</span> 0.5 ise Nötr</li>
<li>0.5 <span class="math inline">\(\leq\)</span> reyting <span class="math inline">\(\leq\)</span> 1.0 ise Al</li>
</ul>
</section>
<section id="indikatörlerin-hesaplanması" class="level2">
<h2 class="anchored" data-anchor-id="indikatörlerin-hesaplanması">İndikatörlerin Hesaplanması</h2>
<p><code>ta_rating_df</code> adında bir pandas DataFrame oluşturalım. Bu DataFrame, tarih (<code>Date</code>), indikatör (<code>Indicator</code>) ve sinyal (<code>Signal</code>) bilgilerini içerecek. İndikatörlerden gelen bilgiler <code>ta_rating_df</code>’te saklanacak.</p>
<div id="9823732d" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ta_rating_df <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">'Date'</span>, <span class="st">'Indicator'</span>, <span class="st">'Signal'</span>])</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sinyallerin-güncellenmesi" class="level3">
<h3 class="anchored" data-anchor-id="sinyallerin-güncellenmesi">Sinyallerin Güncellenmesi</h3>
<p>İndikatörlerin alım-satım stratejilerinde kullanılacak değerlerini optimize ederken alım-satım sinyallerini güncelleyeceğiz. Bu güncelleme ile beraber indikatörün art arda aynı sinyali üretmesi yerine sırayla sinyal üretmesini sağlayacağız.</p>
<div id="d8b0dde2" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_signals(signals):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    updated_signals <span class="op">=</span> []</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    previous_signal <span class="op">=</span> <span class="va">None</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> signal <span class="kw">in</span> signals:</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> signal <span class="op">==</span> previous_signal:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>            updated_signals.append(<span class="dv">0</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>            updated_signals.append(signal)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>            previous_signal <span class="op">=</span> signal <span class="cf">if</span> signal <span class="kw">in</span> (<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>) <span class="cf">else</span> previous_signal</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> updated_signals</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>update_signals</code> fonksiyonu <code>signals</code> adında bir parametre alıyor. Güncellenmiş sinyalleri saklamak için <code>updated_signals</code> adında boş bir liste kullanılıyor. Bir önceki sinyali saklamak için de başlangıçta <code>None</code> olarak ayarlanmış <code>previous_signal</code> adında bir değişken kullanılıyor. Sonra süreç her bir sinyal için <code>for</code> döngüsü ile devam ediyor.</p>
<p><code>if</code> bloğu: Eğer mevcut sinyal önceki sinyal ile aynıysa <code>updated_signals</code> listesine <code>0</code> (nötr sinyali) ekleniyor.</p>
<p><code>else</code> bloğu: Eğer mevcut sinyal önceki sinyal ile aynı değilse <code>updated_signals</code> listesine mevcut sinyal ekleniyor. Devamında ise mevcut sinyal <code>1</code> (al sinyali) veya <code>-1</code> (sat sinyali) ise <code>previous_signal</code> değişkenine <code>signal</code> değişkeninin değeri atanıyor, aksi halde <code>previous_signal</code> değişkeninin değeri korunuyor.</p>
<p>Yukarıdaki işlemler bittikten sonra fonksiyon, <code>updated_signals</code> içerisinde bulunan güncellenmiş sinyaller listesini döndürür.</p>
</section>
<section id="indikatörlerin-optimize-edilmesinde-genel-yaklaşım" class="level3">
<h3 class="anchored" data-anchor-id="indikatörlerin-optimize-edilmesinde-genel-yaklaşım">İndikatörlerin Optimize Edilmesinde Genel Yaklaşım</h3>
<p>İndikatörlerin alım-satım stratejilerinde kullanılacak değerler optimize edilirken hepsinde ortak olan bir süreç bulunmaktadır. Alım-satım sinyali verecek değerler belli bir aralık içine alınır ve tarihsel verilerle kümülatif getirileri hesaplanır. En iyi kümülatif getiriyi sağlayan değerler kullanılarak sinyaller üretilir ve veriler <code>ta_rating_df</code>’te saklanır.</p>
<p>Kodsal olarak süreç şöyledir:</p>
<p><code>best_cum_return</code>, <code>best_params</code> ve <code>best_strategy_df</code> değişkenleri tanımlanır. <code>best_cum_return</code> değişkeninin <code>-np.inf</code> değeri negatif sonsuz demektir ve henüz en iyi kümülatif getirinin hesaplanmadığı; <code>best_params</code> değişkeninin <code>None</code> değeri henüz en iyi getiriyi sağlayan stratejiye ait parametrelerin olmadığı; <code>best_strategy_df</code> değişkeninin <code>None</code> değeri ise henüz en iyi getiriyi sağlayan stratejinin işlem verilerinin olmadığı anlamına gelir.</p>
<p><code>product</code> fonksiyonu ile stratejide kullanılacak değerler oluşturulur ve bu değerler döngüye girer.</p>
<p>Sinyaller üretilir ve bu sinyaller güncellenir. Güncellenen sinyaller üzerinden kümülatif getiriler hesaplanır. Kümülatif getirilerden önce hesaplanan getiri hesaplamasında bir al-sat sinyalinden diğer al-sat sinyaline olan geçişe dikkat edilir.</p>
<p><code>strategy_cum_return</code>’ün <code>best_cum_return</code>’den büyük olup olmadığına bakılır. Eğer büyükse başta oluşturulan değişkenler güncellenir.</p>
<p>Stratejinin en iyi değerleri ekrana basılır ve DataFrame’e son hali verilerek döndürülür.</p>
</section>
<section id="indikatörlerin-optimize-edilmesi" class="level3">
<h3 class="anchored" data-anchor-id="indikatörlerin-optimize-edilmesi">İndikatörlerin Optimize Edilmesi</h3>
<section id="relative-strength-index" class="level4">
<h4 class="anchored" data-anchor-id="relative-strength-index">Relative Strength Index</h4>
<p>Relative Strength Index, bir varlığın geçmiş fiyat değişimlerine dayalı olarak aşırı alım veya aşırı satım durumlarını belirlemeye yardımcı olan bir momentum indikatörüdür.</p>
<p>Relative Strength Index için seçilen strateji, indikatörü kullanarak alım-satım sinyalleri üretir ve bu sinyalleri optimize ederek en iyi kümülatif getiriyi elde etmeyi amaçlar. Belirli bir pencere boyutu, aşırı alım ve aşırı satım seviyeleri aralığını kullanarak fiyatların aşırı alım veya aşırı satım durumunda olup olmadığını belirler. Ardından, bu sinyalleri alım ve satım pozisyonlarına dönüştürür ve stratejinin getirisini hesaplar. En iyi parametrelerle belirlenen bu sinyaller daha sonra alım-satım stratejisi için kullanılır.</p>
<div id="0b120421" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> optimize_and_calculate_rsi(df, window_range, overbought_range, oversold_range):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    best_cum_return <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    best_strategy_df <span class="op">=</span> <span class="va">None</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> window, overbought, oversold <span class="kw">in</span> product(window_range, overbought_range, oversold_range):</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> df.copy().reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        rsi <span class="op">=</span> momentum.RSIIndicator(strategy_df[<span class="st">'Close'</span>], window<span class="op">=</span>window).rsi()</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        signal <span class="op">=</span> np.where(rsi <span class="op">&lt;</span> oversold, <span class="dv">1</span>, np.where(rsi <span class="op">&gt;</span> overbought, <span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Signal'</span>] <span class="op">=</span> signal</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Signal Updated'</span>] <span class="op">=</span> update_signals(strategy_df[<span class="st">'Signal'</span>].tolist())</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">1</span> <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values <span class="kw">and</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values):</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df.copy()</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[strategy_df_ret_calc[<span class="st">'Signal Updated'</span>] <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df_ret_calc[<span class="st">'Close'</span>].pct_change()</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index, row <span class="kw">in</span> strategy_df_ret_calc.iterrows():</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>            signal <span class="op">=</span> row[<span class="st">'Signal Updated'</span>]</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> signal <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>                strategy_df_ret_calc.loc[index, <span class="st">'Strategy Return'</span>] <span class="op">*=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[[<span class="st">'Strategy Return'</span>]]</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> pd.merge(strategy_df, strategy_df_ret_calc, how<span class="op">=</span><span class="st">'left'</span>, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df[<span class="st">'Strategy Return'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Cumulative Return'</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> strategy_df[<span class="st">'Strategy Return'</span>]).cumprod() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>        strategy_cum_return <span class="op">=</span> strategy_df[<span class="st">'Cumulative Return'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> strategy_cum_return <span class="op">&gt;</span> best_cum_return:</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>            best_cum_return <span class="op">=</span> strategy_cum_return</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>            best_params <span class="op">=</span> (window, overbought, oversold)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>            best_strategy_df <span class="op">=</span> strategy_df.copy()</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Best Params (Relative Strength Index): Window=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, Overbought=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">, Oversold=</span><span class="sc">{</span>best_params[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    best_strategy_df[<span class="st">'Date'</span>] <span class="op">=</span> df.index</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    best_strategy_df[<span class="st">'Indicator'</span>] <span class="op">=</span> <span class="st">'Relative Strength Index'</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    rsi_signals_df <span class="op">=</span> best_strategy_df[[<span class="st">'Date'</span>, <span class="st">'Signal'</span>, <span class="st">'Indicator'</span>]]</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rsi_signals_df</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>window_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">10</span>, <span class="dv">21</span>, <span class="dv">1</span>)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>overbought_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">65</span>, <span class="dv">86</span>, <span class="dv">5</span>)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>oversold_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">15</span>, <span class="dv">36</span>, <span class="dv">5</span>)</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>rsi_signals_df <span class="op">=</span> optimize_and_calculate_rsi(df<span class="op">=</span>df, window_range<span class="op">=</span>window_range, overbought_range<span class="op">=</span>overbought_range, oversold_range<span class="op">=</span>oversold_range)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>ta_rating_df <span class="op">=</span> pd.concat([ta_rating_df, rsi_signals_df], ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fonksiyondan alınan aşağıdaki kod bloğunu inceleyelim.</p>
<div id="9e4c29d2" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>rsi <span class="op">=</span> momentum.RSIIndicator(strategy_df[<span class="st">'Close'</span>], window<span class="op">=</span>window).rsi()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>signal <span class="op">=</span> np.where(rsi <span class="op">&lt;</span> oversold, <span class="dv">1</span>, np.where(rsi <span class="op">&gt;</span> overbought, <span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Bu kod bloğu, indikatörün hesaplanmasını ve buna göre alım-satım sinyallerinin üretilmesini sağlar. İlk olarak, belirli bir pencere boyutu kullanılarak RSI hesaplanır. Ardından, RSI değerleri belirlenen aşırı alım ve aşırı satım seviyeleri ile karşılaştırılır. Eğer RSI değeri belirlenen aşırı satım seviyesinin altındaysa, bu durum aşırı satım olarak kabul edilir ve alım sinyali üretilir. Benzer şekilde, RSI değeri belirlenen aşırı alım seviyesinin üzerindeyse, bu durum aşırı alım olarak kabul edilir ve satım sinyali üretilir. RSI değeri bu seviyelerin arasındaysa, herhangi bir alım-satım sinyali üretilmez. Bu şekilde, RSI indikatörü kullanılarak belirli bir varlığın alım-satım kararları otomatik olarak belirlenmiş olur.</p>
<p>RSI stratejisinin optimize edilmesi için kullanılan parametre aralıkları şöyledir:</p>
<ul>
<li><code>window_range</code>: Pencere boyutunun aralığıdır. Değerler 10 ile 20 arasında her biri 1’er birim artacak şekilde belirlenmiştir.</li>
<li><code>overbought_range</code>: Aşırı alım seviyesinin belirlenmesi için kullanılan değerlerin aralığıdır. Değerler 65 ile 85 arasında her biri 5’er birim artacak şekilde belirlenmiştir.</li>
<li><code>oversold_range</code>: Aşırı satım seviyesinin belirlenmesi için kullanılan değerlerin aralığıdır. Değerler 15 ile 35 arasında her biri 5’er birim artacak şekilde belirlenmiştir.</li>
</ul>
<p>Örneğe göre en iyi kümülatif getiriyi sağlayan parametreler şunlardır:</p>
<p><code>Best Params (Relative Strength Index): Window=20, Overbought=85, Oversold=25</code></p>
</section>
<section id="weighted-moving-average" class="level4">
<h4 class="anchored" data-anchor-id="weighted-moving-average">Weighted Moving Average</h4>
<p>Weighted Moving Average, belirli bir zaman diliminde fiyatların ağırlıklı ortalamasını hesaplayarak trendi belirlemeye yardımcı olan bir indikatördür.</p>
<p>Weighted Moving Average için seçilen strateji, indikatörü kullanarak alım-satım sinyalleri üretir ve bu sinyalleri optimize ederek en iyi kümülatif getiriyi elde etmeyi amaçlar. Kısa ve uzun vadeli hareketli ortalamalar arasındaki ilişkiyi değerlendirir. Kısa vadeli WMA’in uzun vadeli WMA’yi aştığı durumlarda alım, kısa vadeli WMA’in uzun vadeli WMA’den düşük olduğu durumlarda satış sinyali üretir. Bu sinyalleri kullanarak stratejinin getirisini hesaplar ve en iyi parametrelerle belirlenen sinyallerle işlem yapar.</p>
<div id="522127b3" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> optimize_and_calculate_wma(df, short_range, long_range):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    best_cum_return <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    best_strategy_df <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> short, <span class="bu">long</span> <span class="kw">in</span> product(short_range, long_range):</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> short <span class="op">&gt;=</span> <span class="bu">long</span>:</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> df.copy().reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        wma_short <span class="op">=</span> trend.WMAIndicator(strategy_df[<span class="st">'Close'</span>], window<span class="op">=</span>short).wma()</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        wma_long <span class="op">=</span> trend.WMAIndicator(strategy_df[<span class="st">'Close'</span>], window<span class="op">=</span><span class="bu">long</span>).wma()</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        signal <span class="op">=</span> np.where(wma_short <span class="op">&gt;</span> wma_long, <span class="dv">1</span>, np.where(wma_short <span class="op">&lt;</span> wma_long, <span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Signal'</span>] <span class="op">=</span> signal</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Signal Updated'</span>] <span class="op">=</span> update_signals(strategy_df[<span class="st">'Signal'</span>].tolist())</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">1</span> <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values <span class="kw">and</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values):</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df.copy()</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[strategy_df_ret_calc[<span class="st">'Signal Updated'</span>] <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df_ret_calc[<span class="st">'Close'</span>].pct_change()</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index, row <span class="kw">in</span> strategy_df_ret_calc.iterrows():</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>            signal <span class="op">=</span> row[<span class="st">'Signal Updated'</span>]</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> signal <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>                strategy_df_ret_calc.loc[index, <span class="st">'Strategy Return'</span>] <span class="op">*=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[[<span class="st">'Strategy Return'</span>]]</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> pd.merge(strategy_df, strategy_df_ret_calc, how<span class="op">=</span><span class="st">'left'</span>, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df[<span class="st">'Strategy Return'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Cumulative Return'</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> strategy_df[<span class="st">'Strategy Return'</span>]).cumprod() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        strategy_cum_return <span class="op">=</span> strategy_df[<span class="st">'Cumulative Return'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> strategy_cum_return <span class="op">&gt;</span> best_cum_return:</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>            best_cum_return <span class="op">=</span> strategy_cum_return</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>            best_params <span class="op">=</span> (short, <span class="bu">long</span>)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>            best_strategy_df <span class="op">=</span> strategy_df.copy()</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Best Params (Weighted Moving Average): Short=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, Long=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    best_strategy_df[<span class="st">'Date'</span>] <span class="op">=</span> df.index</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    best_strategy_df[<span class="st">'Indicator'</span>] <span class="op">=</span> <span class="st">'Weighted Moving Average'</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    wma_signals_df <span class="op">=</span> best_strategy_df[[<span class="st">'Date'</span>, <span class="st">'Signal'</span>, <span class="st">'Indicator'</span>]]</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> wma_signals_df</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>short_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">20</span>, <span class="dv">101</span>, <span class="dv">5</span>)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>long_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">50</span>, <span class="dv">201</span>, <span class="dv">5</span>)</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>wma_signals_df <span class="op">=</span> optimize_and_calculate_wma(df<span class="op">=</span>df, short_range<span class="op">=</span>short_range, long_range<span class="op">=</span>long_range)</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>ta_rating_df <span class="op">=</span> pd.concat([ta_rating_df, wma_signals_df], ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fonksiyondan alınan aşağıdaki kod bloğunu inceleyelim.</p>
<div id="b5a4196d" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>wma_short <span class="op">=</span> trend.wma_indicator(strategy_df[<span class="st">'Close'</span>], window<span class="op">=</span>short)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>wma_long <span class="op">=</span> trend.wma_indicator(strategy_df[<span class="st">'Close'</span>], window<span class="op">=</span><span class="bu">long</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>signal <span class="op">=</span> np.where(wma_short <span class="op">&gt;</span> wma_long, <span class="dv">1</span>, np.where(wma_short <span class="op">&lt;</span> wma_long, <span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Bu kod bloğu, indikatörün hesaplanmasını ve buna göre alım-satım sinyallerinin üretilmesini sağlar. İlk olarak, kısa vadeli WMA ve uzun vadeli WMA değerleri, belirli pencere boyutları (short ve long) kullanılarak hesaplanır. Daha sonra, kısa vadeli WMA’in uzun vadeli WMA’yi aştığı durumlarda alım sinyali üretilir, kısa vadeli WMA’in uzun vadeli WMA’den düşük olduğu durumlarda ise satım sinyali üretilir. Eğer kısa vadeli WMA ve uzun vadeli WMA birbirine eşitse veya kesişirse, herhangi bir sinyal üretilmez. Bu şekilde, WMA indikatörü kullanılarak belirli bir varlığın alım-satım kararları otomatik olarak belirlenmiş olur.</p>
<p>Kısa vadeli değerin uzun vadeli değere eşit veya uzun vadeli değerden büyük olmasının önüne geçilmiştir.</p>
<p>WMA stratejisinin optimize edilmesi için kullanılan parametre aralıkları şöyledir:</p>
<ul>
<li><code>short_range</code>: Kısa vadeli ağırlıklı hareketli ortalama için kullanılacak pencere boyutu aralığıdır. Değerler 20 ile 100 arasında 5’er birim artacak şekilde belirlenmiştir.</li>
<li><code>long_range</code>: Uzun vadeli ağırlıklı hareketli ortalama için kullanılacak pencere boyutu aralığıdır. Değerler 50 ile 200 arasında 5’er birim artacak şekilde belirlenmiştir.</li>
</ul>
<p>Örneğe göre en iyi kümülatif getiriyi sağlayan parametreler şunlardır:</p>
<p><code>Best Params (Weighted Moving Average): Short=45, Long=65</code></p>
</section>
<section id="moving-average-convergence-divergence" class="level4">
<h4 class="anchored" data-anchor-id="moving-average-convergence-divergence">Moving Average Convergence Divergence</h4>
<p>Moving Average Convergence Divergence, iki farklı üssel hareketli ortalamanın (EMA) farkını hesaplayarak trendin yönünü ve gücünü belirlemeye yardımcı olur</p>
<p>Moving Average Convergence Divergence için seçilen strateji, indikatörü kullanarak alım-satım sinyalleri üretir ve bu sinyalleri optimize ederek en iyi kümülatif getiriyi elde etmeyi hedefler. Kısa vadeli ve uzun vadeli hareketli ortalamalar arasındaki farkı ve hareketli ortalamaların ortalama yakınsama ve diverjansını hesaplar. Ardından, sinyal hattıyla karşılaştırarak alım ve satım sinyallerini üretir. Bu sinyallerle stratejinin getirisini hesaplar ve en iyi parametrelerle belirlenen sinyallerle işlem yapar.</p>
<div id="17c7083c" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> optimize_and_calculate_macd(df, window_short_range, window_long_range, window_signal_range):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    best_cum_return <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    best_strategy_df <span class="op">=</span> <span class="va">None</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> window_short, window_long, window_signal <span class="kw">in</span> product(window_short_range, window_long_range, window_signal_range):</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> df.copy().reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        macd_obj <span class="op">=</span> trend.MACD(close<span class="op">=</span>strategy_df[<span class="st">'Close'</span>], window_fast<span class="op">=</span>window_short, window_slow<span class="op">=</span>window_long, window_sign<span class="op">=</span>window_signal)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        macd <span class="op">=</span> macd_obj.macd()</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        signal_line <span class="op">=</span> macd_obj.macd_signal()</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        signal <span class="op">=</span> np.where(macd <span class="op">&gt;</span> signal_line, <span class="dv">1</span>, np.where(macd <span class="op">&lt;</span> signal_line, <span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Signal'</span>] <span class="op">=</span> signal</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Signal Updated'</span>] <span class="op">=</span> update_signals(strategy_df[<span class="st">'Signal'</span>].tolist())</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">1</span> <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values <span class="kw">and</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values):</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df.copy()</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[strategy_df_ret_calc[<span class="st">'Signal Updated'</span>] <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df_ret_calc[<span class="st">'Close'</span>].pct_change()</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index, row <span class="kw">in</span> strategy_df_ret_calc.iterrows():</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>            signal <span class="op">=</span> row[<span class="st">'Signal Updated'</span>]</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> signal <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>                strategy_df_ret_calc.loc[index, <span class="st">'Strategy Return'</span>] <span class="op">*=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[[<span class="st">'Strategy Return'</span>]]</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> pd.merge(strategy_df, strategy_df_ret_calc, how<span class="op">=</span><span class="st">'left'</span>, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df[<span class="st">'Strategy Return'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Cumulative Return'</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> strategy_df[<span class="st">'Strategy Return'</span>]).cumprod() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>        strategy_cum_return <span class="op">=</span> strategy_df[<span class="st">'Cumulative Return'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> strategy_cum_return <span class="op">&gt;</span> best_cum_return:</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>            best_cum_return <span class="op">=</span> strategy_cum_return</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>            best_params <span class="op">=</span> (window_short, window_long, window_signal)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>            best_strategy_df <span class="op">=</span> strategy_df.copy()</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Best Params (Moving Average Convergence Divergence): Short Window=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, Long Window=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">, Signal Window=</span><span class="sc">{</span>best_params[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    best_strategy_df[<span class="st">'Date'</span>] <span class="op">=</span> df.index</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    best_strategy_df[<span class="st">'Indicator'</span>] <span class="op">=</span> <span class="st">'Moving Average Convergence Divergence'</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    macd_signals_df <span class="op">=</span> best_strategy_df[[<span class="st">'Date'</span>, <span class="st">'Signal'</span>, <span class="st">'Indicator'</span>]]</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> macd_signals_df</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>window_short_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">6</span>, <span class="dv">13</span>)</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>window_long_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">20</span>, <span class="dv">41</span>)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>window_signal_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">4</span>, <span class="dv">11</span>)</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>macd_signals_df <span class="op">=</span> optimize_and_calculate_macd(df<span class="op">=</span>df, window_short_range<span class="op">=</span>window_short_range, window_long_range<span class="op">=</span>window_long_range, window_signal_range<span class="op">=</span>window_signal_range)</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>ta_rating_df <span class="op">=</span> pd.concat([ta_rating_df, macd_signals_df], ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fonksiyondan alınan aşağıdaki kod bloğunu inceleyelim.</p>
<div id="687a32d9" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>macd_obj <span class="op">=</span> trend.MACD(close<span class="op">=</span>strategy_df[<span class="st">'Close'</span>], window_fast<span class="op">=</span>window_short, window_slow<span class="op">=</span>window_long, window_sign<span class="op">=</span>window_signal)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>macd <span class="op">=</span> macd_obj.macd()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>signal_line <span class="op">=</span> macd_obj.macd_signal()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>signal <span class="op">=</span> np.where(macd <span class="op">&gt;</span> signal_line, <span class="dv">1</span>, np.where(macd <span class="op">&lt;</span> signal_line, <span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Bu kod bloğu, indikatörün hesaplanmasını ve buna göre alım-satım sinyallerinin üretilmesini sağlar. İlk olarak, hızlı, yavaş ve sinyal pencere boyutları kullanılarak bir MACD nesnesi oluşturulur. MACD hesaplaması, hızlı hareketli ortalamanın yavaş hareketli ortalamadan çıkarılmasıyla elde edilir. Ardından, MACD hattı ve sinyal hattı hesaplanır. MACD hattı, hızlı EMA ile yavaş EMA arasındaki farkı gösterirken, sinyal hattı ise MACD hattının belirli bir zaman aralığındaki hareketli ortalamasıdır. Son olarak, MACD hattının sinyal hattını aştığı durumlarda alım sinyali üretilirken, MACD hattının sinyal hattının aşağısına geçtiği durumlarda satım sinyali üretilir. Eğer MACD hattı ve sinyal hattı birbirine eşitse veya kesişirse, herhangi bir sinyal üretilmez. Bu şekilde, MACD indikatörü kullanılarak belirli bir varlığın alım-satım kararları otomatik olarak belirlenir.</p>
<p>MACD stratejisinin optimize edilmesi için kullanılan parametre aralıkları şöyledir:</p>
<ul>
<li><code>window_short_range</code>: Kısa vadeli hareketli ortalama için kullanılacak pencere boyutu aralığıdır. Değerler 6 ile 12 arasında 1’er birim artacak şekilde belirlenmiştir.</li>
<li><code>window_long_range</code>: Uzun vadeli hareketli ortalama için kullanılacak pencere boyutu aralığıdır. Değerler 20 ile 40 arasında 1’er birim artacak şekilde belirlenmiştir.</li>
<li><code>window_signal_range</code>: MACD hattının sinyal hattını oluşturmak için kullanılacak pencere boyutu aralığıdır. Değerler 4 ile 10 arasında 1’er birim artacak şekilde belirlenmiştir.</li>
</ul>
<p>Örneğe göre en iyi kümülatif getiriyi sağlayan parametreler şunlardır:</p>
<p><code>Best Params (Moving Average Convergence Divergence): Short Window=6, Long Window=20, Signal Window=4</code></p>
</section>
<section id="average-directional-index" class="level4">
<h4 class="anchored" data-anchor-id="average-directional-index">Average Directional Index</h4>
<p>Average Directional Index, bir varlığın trendinin gücünü ölçen bir indikatördür.</p>
<p>Average Directional Index için seçilen strateji, indikatörü kullanarak alım-satım sinyalleri üretir ve bu sinyalleri optimize ederek en iyi kümülatif getiriyi hedefler. ADX, trendin gücünü ölçerken, +DI ve -DI göstergeleri trendin yönünü belirler. Belirli bir pencere boyutu ve eşik değeri ile bu göstergeleri değerlendirir ve belirli bir eşik değerinin üzerindeyse ve +DI, -DI’dan büyükse alım, tersi durumda satım sinyali üretir. Bu sinyallerle stratejinin getirisini hesaplar ve en iyi parametrelerle belirlenen sinyallerle işlem yapar.</p>
<div id="ce5304c8" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> optimize_and_calculate_adx(df, window_range, threshold_range):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    best_cum_return <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    best_strategy_df <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> window <span class="kw">in</span> window_range:</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> threshold <span class="kw">in</span> threshold_range:</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>            strategy_df <span class="op">=</span> df.copy().reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            adx_obj <span class="op">=</span> trend.ADXIndicator(high<span class="op">=</span>strategy_df[<span class="st">'High'</span>], low<span class="op">=</span>strategy_df[<span class="st">'Low'</span>], close<span class="op">=</span>strategy_df[<span class="st">'Close'</span>], window<span class="op">=</span>window)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            adx <span class="op">=</span> adx_obj.adx()</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>            plus_di <span class="op">=</span> adx_obj.adx_pos()</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>            minus_di <span class="op">=</span> adx_obj.adx_neg()</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(strategy_df)):</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                last_adx <span class="op">=</span> adx.iloc[i]</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>                last_plus_di <span class="op">=</span> plus_di.iloc[i]</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>                last_minus_di <span class="op">=</span> minus_di.iloc[i]</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> last_adx <span class="op">&gt;</span> threshold:</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> last_plus_di <span class="op">&gt;</span> last_minus_di:</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>                        signal <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> last_plus_di <span class="op">&lt;</span> last_minus_di:</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>                        signal <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>                        signal <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>                    signal <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>                strategy_df.loc[i, <span class="st">'Signal'</span>] <span class="op">=</span> signal</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>            strategy_df[<span class="st">'Signal Updated'</span>] <span class="op">=</span> update_signals(strategy_df[<span class="st">'Signal'</span>].tolist())</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">1</span> <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values <span class="kw">and</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values):</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>            strategy_df_ret_calc <span class="op">=</span> strategy_df.copy()</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>            strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[strategy_df_ret_calc[<span class="st">'Signal Updated'</span>] <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>            strategy_df_ret_calc[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df_ret_calc[<span class="st">'Close'</span>].pct_change()</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> index, row <span class="kw">in</span> strategy_df_ret_calc.iterrows():</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>                signal <span class="op">=</span> row[<span class="st">'Signal Updated'</span>]</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> signal <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>                    strategy_df_ret_calc.loc[index, <span class="st">'Strategy Return'</span>] <span class="op">*=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>            strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[[<span class="st">'Strategy Return'</span>]]</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>            strategy_df <span class="op">=</span> pd.merge(strategy_df, strategy_df_ret_calc, how<span class="op">=</span><span class="st">'left'</span>, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>            strategy_df[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df[<span class="st">'Strategy Return'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>            strategy_df[<span class="st">'Cumulative Return'</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> strategy_df[<span class="st">'Strategy Return'</span>]).cumprod() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>            strategy_cum_return <span class="op">=</span> strategy_df[<span class="st">'Cumulative Return'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> strategy_cum_return <span class="op">&gt;</span> best_cum_return:</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>                best_cum_return <span class="op">=</span> strategy_cum_return</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>                best_params <span class="op">=</span> (window, threshold)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>                best_strategy_df <span class="op">=</span> strategy_df.copy()</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Best Params (Average Directional Index): Window=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, Threshold=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>    best_strategy_df[<span class="st">'Date'</span>] <span class="op">=</span> df.index</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>    best_strategy_df[<span class="st">'Indicator'</span>] <span class="op">=</span> <span class="st">'Average Directional Index'</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>    adx_signals_df <span class="op">=</span> best_strategy_df[[<span class="st">'Date'</span>, <span class="st">'Signal'</span>, <span class="st">'Indicator'</span>]]</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> adx_signals_df</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>window_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">10</span>, <span class="dv">21</span>)</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>threshold_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">10</span>, <span class="dv">31</span>)</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>adx_signals_df <span class="op">=</span> optimize_and_calculate_adx(df<span class="op">=</span>df, window_range<span class="op">=</span>window_range, threshold_range<span class="op">=</span>threshold_range)</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>ta_rating_df <span class="op">=</span> pd.concat([ta_rating_df, adx_signals_df], ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fonksiyondan alınan aşağıdaki kod bloğunu inceleyelim.</p>
<div id="5b2d59af" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>adx_obj <span class="op">=</span> trend.ADXIndicator(high<span class="op">=</span>strategy_df[<span class="st">'High'</span>], low<span class="op">=</span>strategy_df[<span class="st">'Low'</span>], close<span class="op">=</span>strategy_df[<span class="st">'Close'</span>], window<span class="op">=</span>window)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>adx <span class="op">=</span> adx_obj.adx()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plus_di <span class="op">=</span> adx_obj.adx_pos()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>minus_di <span class="op">=</span> adx_obj.adx_neg()</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(strategy_df)):</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    last_adx <span class="op">=</span> adx.iloc[i]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    last_plus_di <span class="op">=</span> plus_di.iloc[i]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    last_minus_di <span class="op">=</span> minus_di.iloc[i]</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> last_adx <span class="op">&gt;</span> threshold:</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> last_plus_di <span class="op">&gt;</span> last_minus_di:</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>            signal <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> last_plus_di <span class="op">&lt;</span> last_minus_di:</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>            signal <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>            signal <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        signal <span class="op">=</span> <span class="dv">0</span></span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Bu kod bloğu, indikatörün hesaplanmasını ve buna göre alım-satım sinyallerinin üretilmesini sağlar. İlk olarak, yüksek, düşük ve kapanış fiyatlarından oluşan veri seti ile birlikte belirli bir pencere boyutu kullanılarak bir ADX nesnesi oluşturulur. Daha sonra, ADX’in yanı sıra +DI ve -DI endeksler de hesaplanır. +DI, alım hareketinin gücünü, -DI ise satım hareketinin gücünü ölçer. Son olarak, belirlenen bir eşik değeri (threshold) kullanılarak alım-satım sinyalleri üretilir. Eğer ADX değeri belirli eşik değerini aşarsa, +DI ve -DI yönlü endeksler karşılaştırılır. Eğer +DI, -DI’dan büyükse, alım sinyali üretilir. Eğer -DI, +DI’dan büyükse, satım sinyali üretilir. Eğer artı ve eksi endeksler birbirine eşitse veya eşik değerini aşan bir ADX değeri yoksa, herhangi bir sinyal üretilmez. Bu şekilde, ADX indikatörü kullanılarak belirli bir varlığın trendinin gücüne bağlı olarak alım-satım kararları otomatik olarak belirlenir.</p>
<p>ADX stratejisinin optimize edilmesi için kullanılan parametre aralıkları şöyledir:</p>
<ul>
<li><code>window_range</code>: Pencere boyutu aralığıdır. Değerler 10 ile 20 arasında 1’er birim artacak şekilde belirlenmiştir.</li>
<li><code>threshold_range</code>: ADX indikatörünün değerini değerlendirirken kullanılacak olan eşik değerdir. Değerler 10 ile 30 arasında 1’er birim artacak şekilde belirlenmiştir.</li>
</ul>
<p>Örneğe göre en iyi kümülatif getiriyi sağlayan parametreler şunlardır:</p>
<p><code>Best Params (Average Directional Index): Window=11, Threshold=12</code></p>
</section>
<section id="bollinger-bands" class="level4">
<h4 class="anchored" data-anchor-id="bollinger-bands">Bollinger Bands</h4>
<p>Bollinger Bands, fiyatların ortalamadan sapmasını ölçerek volatiliteyi gösteren bir indikatördür.</p>
<p>Bollinger Bands için seçilen strateji, indikatörü kullanarak alım-satım sinyalleri üretir ve bu sinyalleri optimize ederek en iyi kümülatif getiriyi hedefler. Bollinger Bands, fiyatın ortalamadan ne kadar uzakta olduğunu ölçer ve standart sapma kullanarak üst ve alt bantları hesaplar. Belirli bir pencere boyutu ve standart sapma aralığı ile bu bantları hesaplar ve fiyatın bu bantların içinde veya dışında olduğu durumları değerlendirir. Fiyatın alt bant altında olduğu durumlarda alım, üst bant üstünde olduğu durumlarda satım sinyali üretir. Bu sinyallerle stratejinin getirisini hesaplar ve en iyi parametrelerle belirlenen sinyallerle işlem yapar.</p>
<div id="97cd8bb2" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> optimize_and_calculate_bollinger_bands(df, window_range, std_dev_range):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    best_cum_return <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    best_strategy_df <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> window, std_dev <span class="kw">in</span> product(window_range, std_dev_range):</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> df.copy().reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        bb <span class="op">=</span> volatility.BollingerBands(close<span class="op">=</span>strategy_df[<span class="st">'Close'</span>], window<span class="op">=</span>window, window_dev<span class="op">=</span>std_dev)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        bb_lband <span class="op">=</span> bb.bollinger_lband()</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        bb_hband <span class="op">=</span> bb.bollinger_hband()</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(strategy_df)):</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>            lband <span class="op">=</span> bb_lband.iloc[i]</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>            hband <span class="op">=</span> bb_hband.iloc[i]</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>            close_price <span class="op">=</span> strategy_df[<span class="st">'Close'</span>].iloc[i]</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> close_price <span class="op">&lt;</span> lband:</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>                signal <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> close_price <span class="op">&gt;</span> hband:</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>                signal <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>                signal <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>            strategy_df.loc[i, <span class="st">'Signal'</span>] <span class="op">=</span> signal</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Signal Updated'</span>] <span class="op">=</span> update_signals(strategy_df[<span class="st">'Signal'</span>].tolist())</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">1</span> <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values <span class="kw">and</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values):</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df.copy()</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[strategy_df_ret_calc[<span class="st">'Signal Updated'</span>] <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df_ret_calc[<span class="st">'Close'</span>].pct_change()</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index, row <span class="kw">in</span> strategy_df_ret_calc.iterrows():</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>            signal <span class="op">=</span> row[<span class="st">'Signal Updated'</span>]</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> signal <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>                strategy_df_ret_calc.loc[index, <span class="st">'Strategy Return'</span>] <span class="op">*=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[[<span class="st">'Strategy Return'</span>]]</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> pd.merge(strategy_df, strategy_df_ret_calc, how<span class="op">=</span><span class="st">'left'</span>, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df[<span class="st">'Strategy Return'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Cumulative Return'</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> strategy_df[<span class="st">'Strategy Return'</span>]).cumprod() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>        strategy_cum_return <span class="op">=</span> strategy_df[<span class="st">'Cumulative Return'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> strategy_cum_return <span class="op">&gt;</span> best_cum_return:</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>            best_cum_return <span class="op">=</span> strategy_cum_return</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>            best_params <span class="op">=</span> (window, std_dev)</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>            best_strategy_df <span class="op">=</span> strategy_df.copy()</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Best Params (Bollinger Bands): Window=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, Std Dev=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    best_strategy_df[<span class="st">'Date'</span>] <span class="op">=</span> df.index</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>    best_strategy_df[<span class="st">'Indicator'</span>] <span class="op">=</span> <span class="st">'Bollinger Bands'</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    bb_signals_df <span class="op">=</span> best_strategy_df[[<span class="st">'Date'</span>, <span class="st">'Signal'</span>, <span class="st">'Indicator'</span>]]</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> bb_signals_df</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>window_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">10</span>, <span class="dv">21</span>)</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>std_dev_range <span class="op">=</span> np.arange(<span class="dv">1</span>, <span class="fl">3.5</span>, <span class="fl">0.5</span>)</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>bb_signals_df <span class="op">=</span> optimize_and_calculate_bollinger_bands(df<span class="op">=</span>df, window_range<span class="op">=</span>window_range, std_dev_range<span class="op">=</span>std_dev_range)</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>ta_rating_df <span class="op">=</span> pd.concat([ta_rating_df, bb_signals_df], ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fonksiyondan alınan aşağıdaki kod bloğunu inceleyelim.</p>
<div id="19d42037" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>bb <span class="op">=</span> volatility.BollingerBands(close<span class="op">=</span>strategy_df[<span class="st">'Close'</span>], window<span class="op">=</span>window, window_dev<span class="op">=</span>std_dev)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>bb_lband <span class="op">=</span> bb.bollinger_lband()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>bb_hband <span class="op">=</span> bb.bollinger_hband()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(strategy_df)):</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    lband <span class="op">=</span> bb_lband.iloc[i]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    hband <span class="op">=</span> bb_hband.iloc[i]</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    close_price <span class="op">=</span> strategy_df[<span class="st">'Close'</span>].iloc[i]</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> close_price <span class="op">&lt;</span> lband:</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        signal <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> close_price <span class="op">&gt;</span> hband:</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        signal <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        signal <span class="op">=</span> <span class="dv">0</span></span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Bu kod bloğu, indikatörün hesaplanmasını ve buna göre alım-satım sinyallerinin üretilmesini sağlar. İlk olarak, kapanış fiyatları verisiyle birlikte belirli bir pencere boyutu ve standart sapma kullanılarak bir Bollinger Bands nesnesi oluşturulur. Daha sonra, alt bant ve üst bant değerleri hesaplanır. Alt bant, hareketli ortalama fiyatın belirli bir standart sapma kadar altında, üst bant ise hareketli ortalama fiyatın belirli bir standart sapma kadar üstünde yer alır. Son olarak, her bir veri noktası için kapanış fiyatı, alt bant ve üst bant değerleri karşılaştırılarak alım-satım sinyali üretilir. Eğer kapanış fiyatı alt banttan daha düşükse alım sinyali üretilir. Eğer kapanış fiyatı üst banttan daha yüksekse satım sinyali üretilir. Eğer kapanış fiyatı alt bant ve üst bant arasındaysa herhangi bir sinyal üretilmez. Bu şekilde, Bollinger Bands indikatörü kullanılarak belirli bir varlığın fiyat hareketleriyle ilgili alım-satım kararları otomatik olarak belirlenmiş olur.</p>
<p>Bollinger Bands stratejisinin optimize edilmesi için kullanılan parametre aralıkları şöyledir:</p>
<ul>
<li><code>window_range</code>: Hareketli ortalama pencere boyutu aralığıdır. Değerler 10 ile 20 arasında 1’er birim artacak şekilde belirlenmiştir.</li>
<li><code>std_dev_range</code>: Standart sapma değer aralığıdır. Değerler 1 ile 3.5 arasında 0.5’er birim artacak şekilde belirlenmiştir.</li>
</ul>
<p>Örneğe göre en iyi kümülatif getiriyi sağlayan parametreler şunlardır:</p>
<p><code>Best Params (Bollinger Bands): Window=10, Std Dev=2.5</code></p>
</section>
<section id="rate-of-change" class="level4">
<h4 class="anchored" data-anchor-id="rate-of-change">Rate of Change</h4>
<p>Rate of Change, belirli bir zaman diliminde fiyatların yüzde değişimini ölçerek fiyatların momentumunu gösteren bir indikatördür.</p>
<p>Rate of Change için seçilen strateji, indikatörü kullanarak alım-satım sinyalleri üretir ve bu sinyalleri optimize ederek en iyi kümülatif getiriyi hedefler. Belirli bir pencere boyutu ve aşırı alım/aşırı satım seviyeleri aralığı ile fiyatın geçmiş performansını ölçer. ROC değeri, belirli bir dönemde fiyatın yüzde değişimini gösterir. Ardından, aşırı alım veya aşırı satım seviyelerini geçtiğinde alım veya satım sinyali üretir. Bu sinyallerle stratejinin getirisini hesaplar ve en iyi parametrelerle belirlenen sinyallerle işlem yapar.</p>
<div id="7171a1ce" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> optimize_and_calculate_roc(df, window_range, overbought_range, oversold_range):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    best_cum_return <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    best_strategy_df <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> window, overbought, oversold <span class="kw">in</span> product(window_range, overbought_range, oversold_range):</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> df.copy().reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        roc <span class="op">=</span> momentum.ROCIndicator(strategy_df[<span class="st">'Close'</span>], window<span class="op">=</span>window).roc()</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        signal <span class="op">=</span> np.where(roc <span class="op">&gt;</span> overbought, <span class="op">-</span><span class="dv">1</span>, np.where(roc <span class="op">&lt;</span> oversold, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Signal'</span>] <span class="op">=</span> signal</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Signal Updated'</span>] <span class="op">=</span> update_signals(strategy_df[<span class="st">'Signal'</span>].tolist())</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">1</span> <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values <span class="kw">and</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values):</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df.copy()</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[strategy_df_ret_calc[<span class="st">'Signal Updated'</span>] <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df_ret_calc[<span class="st">'Close'</span>].pct_change()</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index, row <span class="kw">in</span> strategy_df_ret_calc.iterrows():</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>            signal <span class="op">=</span> row[<span class="st">'Signal Updated'</span>]</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> signal <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>                strategy_df_ret_calc.loc[index, <span class="st">'Strategy Return'</span>] <span class="op">*=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[[<span class="st">'Strategy Return'</span>]]</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> pd.merge(strategy_df, strategy_df_ret_calc, how<span class="op">=</span><span class="st">'left'</span>, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df[<span class="st">'Strategy Return'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Cumulative Return'</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> strategy_df[<span class="st">'Strategy Return'</span>]).cumprod() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>        strategy_cum_return <span class="op">=</span> strategy_df[<span class="st">'Cumulative Return'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> strategy_cum_return <span class="op">&gt;</span> best_cum_return:</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>            best_cum_return <span class="op">=</span> strategy_cum_return</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>            best_params <span class="op">=</span> (window, overbought, oversold)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>            best_strategy_df <span class="op">=</span> strategy_df.copy()</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Best Params (Rate of Change): Window=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, Overbought=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">, Oversold=</span><span class="sc">{</span>best_params[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>    best_strategy_df[<span class="st">'Date'</span>] <span class="op">=</span> df.index</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    best_strategy_df[<span class="st">'Indicator'</span>] <span class="op">=</span> <span class="st">'Rate of Change'</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    roc_signals_df <span class="op">=</span> best_strategy_df[[<span class="st">'Date'</span>, <span class="st">'Signal'</span>, <span class="st">'Indicator'</span>]]</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> roc_signals_df</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>window_range_roc <span class="op">=</span> <span class="bu">range</span>(<span class="dv">5</span>, <span class="dv">21</span>, <span class="dv">5</span>)</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>overbought_range_roc <span class="op">=</span> <span class="bu">range</span>(<span class="dv">5</span>, <span class="dv">31</span>, <span class="dv">5</span>)</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>oversold_range_roc <span class="op">=</span> <span class="bu">range</span>(<span class="op">-</span><span class="dv">5</span>, <span class="op">-</span><span class="dv">31</span>, <span class="op">-</span><span class="dv">5</span>)</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>roc_signals_df <span class="op">=</span> optimize_and_calculate_roc(df<span class="op">=</span>df, window_range<span class="op">=</span>window_range_roc, overbought_range<span class="op">=</span>overbought_range_roc, oversold_range<span class="op">=</span>oversold_range_roc)</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>ta_rating_df <span class="op">=</span> pd.concat([ta_rating_df, roc_signals_df], ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fonksiyondan alınan aşağıdaki kod bloğunu inceleyelim.</p>
<div id="0dac8b17" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>roc <span class="op">=</span> momentum.ROCIndicator(strategy_df[<span class="st">'Close'</span>], window<span class="op">=</span>window).roc()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>signal <span class="op">=</span> np.where(roc <span class="op">&gt;</span> overbought, <span class="op">-</span><span class="dv">1</span>, np.where(roc <span class="op">&lt;</span> oversold, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Bu kod bloğu, indikatörün hesaplanmasını ve buna göre alım-satım sinyallerinin üretilmesini sağlar. İlk olarak, kapanış fiyatları verisiyle birlikte belirli bir pencere boyutu kullanılarak bir ROC nesnesi oluşturulur. Daha sonra, ROC değerleri belirlenen bir aşırı alım ve aşırı satım seviyeleri ile karşılaştırılarak alım-satım sinyalleri üretilir. Eğer ROC değeri aşırı alım seviyesini aşarsa satım sinyali üretilir. Eğer ROC değeri aşırı satım seviyesinin altına düşerse alım sinyali üretilir. Eğer ROC değeri aşırı alım veya aşırı satım seviyeleri arasındaysa herhangi bir sinyal üretilmez. Bu şekilde, ROC indikatörü kullanılarak belirli bir varlığın fiyat momentumuyla ilişkili alım-satım kararları otomatik olarak belirlenir.</p>
<p>ROC stratejisinin optimize edilmesi için kullanılan parametre aralıkları şöyledir:</p>
<ul>
<li><code>window_range</code>: Pencere boyutu aralığıdır. Değerler 5 ile 20 arasında 5’er birim artacak şekilde belirlenmiştir.</li>
<li><code>overbought_range</code>: Aşırı alım seviyesinin belirlenmesi için kullanılan değerlerin aralığıdır. Değerler 5 ile 30 arasında 5’er birim artacak şekilde belirlenmiştir.</li>
<li><code>oversold_range</code>: Aşırı satım seviyesinin belirlenmesi için kullanılan değerlerin aralığıdır. Değerler -5 ile -30 arasında 5’er birim azalacak şekilde belirlenmiştir.</li>
</ul>
<p>Örneğe göre en iyi kümülatif getiriyi sağlayan parametreler şunlardır:</p>
<p><code>Best Params (Rate of Change): Window=5, Overbought=5, Oversold=-15</code></p>
</section>
<section id="ichimoku" class="level4">
<h4 class="anchored" data-anchor-id="ichimoku">Ichimoku</h4>
<p>Ichimoku Kinko Hyo, genellikle kısaca Ichimoku olarak bilinen, çok yönlü bir teknik analiz indikatörüdür. Ichimoku, bir varlığın destek ve direnç seviyelerini, trend yönünü, momentumunu ve olası sinyalleri belirlemeye yardımcı olur. Ichimoku, tek bir grafikte beş ana bileşeni birleştirir ve bu da onu oldukça kapsamlı bir analiz aracı yapar.</p>
<p>Ichimoku için seçilen strateji, indikatörü kullanarak alım-satım sinyalleri üretir ve bu sinyalleri optimize ederek en iyi kümülatif getiriyi hedefler. Ichimoku Bulutu, beş çizgiden oluşur: Tenkan-sen, Kijun-sen, Senkou Span A, Senkou Span B ve Chikou Span. Bu stratejide, Tenkan-sen ve Kijun-sen çizgilerinin kesişimlerine dayalı alım-satım sinyalleri üretilir. Ayrıca, fiyatın Senkou Span A ve Senkou Span B arasında veya dışında olması durumuna göre de alım-satım sinyalleri üretilir. Bu sinyallerle stratejinin getirisini hesaplar ve en iyi parametrelerle belirlenen sinyallerle işlem yapar.</p>
<div id="e5bc3df3" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> optimize_and_calculate_ichimoku(df, tenkan_range, kijun_range, senkou_span_b_range):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    best_cum_return <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    best_params <span class="op">=</span> <span class="va">None</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    best_strategy_df <span class="op">=</span> <span class="va">None</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tenkan, kijun, senkou_span_b <span class="kw">in</span> product(tenkan_range, kijun_range, senkou_span_b_range):</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> df.copy().reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        ichimoku <span class="op">=</span> trend.IchimokuIndicator(strategy_df[<span class="st">'High'</span>], strategy_df[<span class="st">'Low'</span>], window1<span class="op">=</span>tenkan, window2<span class="op">=</span>kijun, window3<span class="op">=</span>senkou_span_b)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Tenkan'</span>] <span class="op">=</span> ichimoku.ichimoku_conversion_line()</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Kijun'</span>] <span class="op">=</span> ichimoku.ichimoku_base_line()</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Senkou_A'</span>] <span class="op">=</span> ichimoku.ichimoku_a()</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Senkou_B'</span>] <span class="op">=</span> ichimoku.ichimoku_b()</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Lagging_Span'</span>] <span class="op">=</span> strategy_df[<span class="st">'Close'</span>].shift(<span class="op">-</span>kijun)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        signals <span class="op">=</span> []</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(strategy_df)):</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>            price <span class="op">=</span> strategy_df[<span class="st">'Close'</span>].iloc[i]</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>            tenkan_sen <span class="op">=</span> strategy_df[<span class="st">'Tenkan'</span>].iloc[i]</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>            kijun_sen <span class="op">=</span> strategy_df[<span class="st">'Kijun'</span>].iloc[i]</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>            senkou_a <span class="op">=</span> strategy_df[<span class="st">'Senkou_A'</span>].iloc[i]</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>            senkou_b <span class="op">=</span> strategy_df[<span class="st">'Senkou_B'</span>].iloc[i]</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> price <span class="op">&gt;</span> <span class="bu">max</span>(senkou_a, senkou_b):</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> price <span class="op">&gt;</span> tenkan_sen <span class="kw">and</span> tenkan_sen <span class="op">&gt;</span> kijun_sen:</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>                    signals.append(<span class="dv">1</span>)</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>                    signals.append(<span class="dv">0</span>)</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> price <span class="op">&lt;</span> <span class="bu">min</span>(senkou_a, senkou_b):</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> price <span class="op">&lt;</span> tenkan_sen <span class="kw">and</span> tenkan_sen <span class="op">&lt;</span> kijun_sen:</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>                    signals.append(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>                    signals.append(<span class="dv">0</span>)</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>                signals.append(<span class="dv">0</span>)</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Signal'</span>] <span class="op">=</span> signals</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Signal Updated'</span>] <span class="op">=</span> update_signals(strategy_df[<span class="st">'Signal'</span>].tolist())</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">1</span> <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values <span class="kw">and</span> <span class="op">-</span><span class="dv">1</span> <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values):</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df.copy()</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[strategy_df_ret_calc[<span class="st">'Signal Updated'</span>] <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df_ret_calc[<span class="st">'Close'</span>].pct_change()</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index, row <span class="kw">in</span> strategy_df_ret_calc.iterrows():</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>            signal <span class="op">=</span> row[<span class="st">'Signal Updated'</span>]</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> signal <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>                strategy_df_ret_calc.loc[index, <span class="st">'Strategy Return'</span>] <span class="op">*=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[[<span class="st">'Strategy Return'</span>]]</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> pd.merge(strategy_df, strategy_df_ret_calc, how<span class="op">=</span><span class="st">'left'</span>, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df[<span class="st">'Strategy Return'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Cumulative Return'</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> strategy_df[<span class="st">'Strategy Return'</span>]).cumprod() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>        strategy_cum_return <span class="op">=</span> strategy_df[<span class="st">'Cumulative Return'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> strategy_cum_return <span class="op">&gt;</span> best_cum_return:</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>            best_cum_return <span class="op">=</span> strategy_cum_return</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>            best_params <span class="op">=</span> (tenkan, kijun, senkou_span_b)</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>            best_strategy_df <span class="op">=</span> strategy_df.copy()</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Best Params (Ichimoku): Tenkan=</span><span class="sc">{</span>best_params[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, Kijun=</span><span class="sc">{</span>best_params[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">, Senkou Span B=</span><span class="sc">{</span>best_params[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>    best_strategy_df[<span class="st">'Date'</span>] <span class="op">=</span> df.index</span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>    best_strategy_df[<span class="st">'Indicator'</span>] <span class="op">=</span> <span class="st">'Ichimoku'</span></span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>    ichimoku_signals_df <span class="op">=</span> best_strategy_df[[<span class="st">'Date'</span>, <span class="st">'Signal'</span>, <span class="st">'Indicator'</span>]]</span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ichimoku_signals_df</span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>tenkan_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>kijun_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">20</span>, <span class="dv">31</span>, <span class="dv">5</span>)</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>senkou_span_b_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">50</span>, <span class="dv">101</span>, <span class="dv">10</span>)</span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>ichimoku_signals_df <span class="op">=</span> optimize_and_calculate_ichimoku(df<span class="op">=</span>df, tenkan_range<span class="op">=</span>tenkan_range, kijun_range<span class="op">=</span>kijun_range, senkou_span_b_range<span class="op">=</span>senkou_span_b_range)</span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>ta_rating_df <span class="op">=</span> pd.concat([ta_rating_df, ichimoku_signals_df], ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fonksiyondan alınan aşağıdaki kod bloğunu inceleyelim.</p>
<div id="74186f50" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ichimoku <span class="op">=</span> trend.IchimokuIndicator(strategy_df[<span class="st">'High'</span>], strategy_df[<span class="st">'Low'</span>], window1<span class="op">=</span>tenkan, window2<span class="op">=</span>kijun, window3<span class="op">=</span>senkou_span_b)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>strategy_df[<span class="st">'Tenkan'</span>] <span class="op">=</span> ichimoku.ichimoku_conversion_line()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>strategy_df[<span class="st">'Kijun'</span>] <span class="op">=</span> ichimoku.ichimoku_base_line()</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>strategy_df[<span class="st">'Senkou_A'</span>] <span class="op">=</span> ichimoku.ichimoku_a()</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>strategy_df[<span class="st">'Senkou_B'</span>] <span class="op">=</span> ichimoku.ichimoku_b()</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>strategy_df[<span class="st">'Lagging_Span'</span>] <span class="op">=</span> strategy_df[<span class="st">'Close'</span>].shift(<span class="op">-</span>kijun)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>signals <span class="op">=</span> []</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(strategy_df)):</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    price <span class="op">=</span> strategy_df[<span class="st">'Close'</span>].iloc[i]</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    tenkan_sen <span class="op">=</span> strategy_df[<span class="st">'Tenkan'</span>].iloc[i]</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    kijun_sen <span class="op">=</span> strategy_df[<span class="st">'Kijun'</span>].iloc[i]</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    senkou_a <span class="op">=</span> strategy_df[<span class="st">'Senkou_A'</span>].iloc[i]</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    senkou_b <span class="op">=</span> strategy_df[<span class="st">'Senkou_B'</span>].iloc[i]</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> price <span class="op">&gt;</span> <span class="bu">max</span>(senkou_a, senkou_b):</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> price <span class="op">&gt;</span> tenkan_sen <span class="kw">and</span> tenkan_sen <span class="op">&gt;</span> kijun_sen:</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>            signals.append(<span class="dv">1</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>            signals.append(<span class="dv">0</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> price <span class="op">&lt;</span> <span class="bu">min</span>(senkou_a, senkou_b):</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> price <span class="op">&lt;</span> tenkan_sen <span class="kw">and</span> tenkan_sen <span class="op">&lt;</span> kijun_sen:</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>            signals.append(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>            signals.append(<span class="dv">0</span>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>        signals.append(<span class="dv">0</span>)</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Bu kod bloğu, indikatörün hesaplanmasını ve buna göre alım-satım sinyallerinin üretilmesini sağlar. İlk olarak, yüksek ve düşük fiyatlarla birlikte Tenkan Sen, Kijun Sen, Senkou Span A ve Senkou Span B gibi farklı bileşenlerin hesaplanması için bir Ichimoku nesnesi oluşturulur. Daha sonra, her bir bileşenin değeri, Ichimoku nesnesinin ilgili metotları kullanılarak hesaplanır ve strateji veri çerçevesine eklenir. Ayrıca, geriye kaydırılmış bir Lagging Span bileşeni de oluşturulur. Son olarak, her bir veri noktası için fiyat ve Ichimoku bileşenlerinin değerleri karşılaştırılarak alım-satım sinyalleri üretilir. Eğer fiyat, Senkou Span A ve Senkou Span B’nin maksimum değeriyle karşılaştırıldığında daha yüksekse ve Tenkan Sen, Kijun Sen’in üzerindeyse, alım sinyali üretilir. Eğer fiyat, Senkou Span A ve Senkou Span B’nin minimum değeriyle karşılaştırıldığında daha düşükse ve Tenkan Sen, Kijun Sen’in altındaysa, satım sinyali üretilir. Aksi takdirde, herhangi bir sinyal üretilmez. Bu şekilde, Ichimoku Kinko Hyo indikatörü kullanılarak belirli bir varlığın trendi ve potansiyel alım-satım fırsatları hakkında bilgi sağlanır ve alım-satım sinyalleri otomatik olarak belirlenir.</p>
<p>Ichimoku stratejisinin optimize edilmesi için kullanılan parametre aralıkları şöyledir:</p>
<ul>
<li><code>tenkan_range</code>: Tenkan Sen (dönüş hattı) için kullanılacak dönem aralığıdır. Değerler 5 ile 9 arasında belirlenmiştir.</li>
<li><code>kijun_range</code>: Kijun Sen (standart hattı) için kullanılacak dönem aralığıdır. Değerler 20 ile 30 arasında 5’er birim artacak şekilde belirlenmiştir.</li>
<li><code>senkou_span_b_range</code>: Senkou Span B (ön gösterge B) için kullanılacak dönem aralığıdır. Değerler 50 ile 100 arasında 10’ar birim artacak şekilde belirlenmiştir.</li>
</ul>
<p>Örneğe göre en iyi kümülatif getiriyi sağlayan parametreler şunlardır:</p>
<p><code>Best Params (Ichimoku): Tenkan=6, Kijun=20, Senkou Span B=50</code></p>
</section>
</section>
</section>
<section id="reytinglerin-hesaplanması" class="level2">
<h2 class="anchored" data-anchor-id="reytinglerin-hesaplanması">Reytinglerin Hesaplanması</h2>
<section id="pandas-dataframein-güncellenmesi" class="level3">
<h3 class="anchored" data-anchor-id="pandas-dataframein-güncellenmesi">Pandas DataFrame’in Güncellenmesi</h3>
<p><code>ta_rating_df</code>’i <code>pivot_table</code> yardımıyla aşağıdaki formata çevirelim ve yeni tabloyu <code>pivot_ta_rating_df</code>’e atayalım.</p>
<p><img src="imgs/img_2.PNG" class="img-fluid"></p>
<div id="e8d3a8d0" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>pivot_ta_rating_df <span class="op">=</span> ta_rating_df.pivot_table(index<span class="op">=</span><span class="st">'Date'</span>, columns<span class="op">=</span><span class="st">'Indicator'</span>, values<span class="op">=</span><span class="st">'Signal'</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>pivot_ta_rating_df.columns.name <span class="op">=</span> <span class="va">None</span></span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="imgs/img_3.PNG" class="img-fluid"></p>
</section>
<section id="indikatör-listesinin-oluşturulması" class="level3">
<h3 class="anchored" data-anchor-id="indikatör-listesinin-oluşturulması">İndikatör Listesinin Oluşturulması</h3>
<p>Daha önce seçtiğimiz indikatörleri bir liste içerisine alalım.</p>
<div id="a5354b50" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>indicators <span class="op">=</span> [</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Relative Strength Index'</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Weighted Moving Average'</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Moving Average Convergence Divergence'</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Average Directional Index'</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Bollinger Bands'</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Rate of Change'</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Ichimoku'</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reyting-aralığının-oluşturulması" class="level3">
<h3 class="anchored" data-anchor-id="reyting-aralığının-oluşturulması">Reyting Aralığının Oluşturulması</h3>
<p>Aşağıdaki kriterleri <code>signal_to_category</code> adında bir fonksiyonda tanımlayalım.</p>
<ul>
<li>-1.0 <span class="math inline">\(\leq\)</span> reyting <span class="math inline">\(\leq\)</span> -0.5 ise Sat</li>
<li>-0.5 <span class="math inline">\(&lt;\)</span> reyting <span class="math inline">\(&lt;\)</span> 0.5 ise Nötr</li>
<li>0.5 <span class="math inline">\(\leq\)</span> reyting <span class="math inline">\(\leq\)</span> 1.0 ise Al</li>
</ul>
<div id="b85c90c3" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> signal_to_category(signal):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">-</span><span class="fl">1.0</span> <span class="op">&lt;=</span> signal <span class="op">&lt;=</span> <span class="op">-</span><span class="fl">0.5</span>:</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="op">-</span><span class="fl">0.5</span> <span class="op">&lt;</span> signal <span class="op">&lt;</span> <span class="fl">0.5</span>:</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="fl">0.5</span> <span class="op">&lt;=</span> signal <span class="op">&lt;=</span> <span class="fl">1.0</span>:</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="indikatör-ağırlıklarının-optimize-edilmesi" class="level3">
<h3 class="anchored" data-anchor-id="indikatör-ağırlıklarının-optimize-edilmesi">İndikatör Ağırlıklarının Optimize Edilmesi</h3>
<p>Tüm süreci <code>optimize_weights_and_evaluate</code> adındaki fonksiyonun içerisinde yürüteceğiz.</p>
<p>Fonksiyon, 5 adet parametre alıyor.</p>
<ul>
<li><code>df</code>: İlgili finansal varlığın (örneğimizde BTC-USD) tarihsel verilerinin bulunduğu <code>df</code>’tir.</li>
<li><code>pivot_df</code>: Son oluşturulan <code>pivot_ta_rating_df</code>’tir.</li>
<li><code>indicators</code>: İndikatör listesidir.</li>
<li><code>initial_value</code>: 100 birimin ne olduğuna bakılır. Parametrenin varsayılan değeri <code>100</code>’dür.</li>
<li><code>plot</code>: Süreç tamamlandığında ekrana üç adet görsel basılır. İlk görsel, stratejinin nerelerde alım-satım sinyali ürettiğini gösterir. İkinci görsel, strateji ile al-tut stratejisini karşılaştırır. Üçüncü görsel ise indikatörlerin ağırlıklarını verir. Parametrenin varsayılan değeri <code>False</code>’tur.</li>
</ul>
<div id="a3f1e8b0" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> optimize_weights_and_evaluate(df, pivot_df, indicators, initial_value<span class="op">=</span><span class="dv">100</span>, plot<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    best_cum_return <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    best_weights <span class="op">=</span> <span class="va">None</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    best_strategy_df <span class="op">=</span> <span class="va">None</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    buy_and_hold_cum_return <span class="op">=</span> (df[<span class="st">'Close'</span>].pct_change().dropna() <span class="op">+</span> <span class="dv">1</span>).cumprod().iloc[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> best_cum_return <span class="op">&lt;=</span> buy_and_hold_cum_return:</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> pivot_df.copy()</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        weights <span class="op">=</span> (np.random.rand(<span class="bu">len</span>(indicators)) <span class="op">/</span> np.random.rand(<span class="bu">len</span>(indicators)).<span class="bu">sum</span>())</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        weights <span class="op">=</span> weights <span class="op">/</span> weights.<span class="bu">sum</span>()</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        weight_dict <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(indicators, weights))</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        weighted_ratings <span class="op">=</span> strategy_df.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="bu">sum</span>(row[indicator] <span class="op">*</span> weight_dict[indicator] <span class="cf">for</span> indicator <span class="kw">in</span> indicators), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Weighted Average Rating'</span>] <span class="op">=</span> weighted_ratings</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Signal'</span>] <span class="op">=</span> strategy_df[<span class="st">'Weighted Average Rating'</span>].<span class="bu">apply</span>(signal_to_category)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Signal Updated'</span>] <span class="op">=</span> update_signals(strategy_df[<span class="st">'Signal'</span>].tolist())</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">any</span>(signal <span class="kw">in</span> strategy_df[<span class="st">'Signal Updated'</span>].values <span class="cf">for</span> signal <span class="kw">in</span> [<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>]):</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Close'</span>] <span class="op">=</span> df[<span class="st">'Close'</span>].reindex(strategy_df.index)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> strategy_df.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df.copy()</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[strategy_df_ret_calc[<span class="st">'Signal Updated'</span>] <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df_ret_calc[<span class="st">'Close'</span>].pct_change()</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index, row <span class="kw">in</span> strategy_df_ret_calc.iterrows():</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>            signal <span class="op">=</span> row[<span class="st">'Signal Updated'</span>]</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> signal <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>                strategy_df_ret_calc.loc[index, <span class="st">'Strategy Return'</span>] <span class="op">*=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>        strategy_df_ret_calc <span class="op">=</span> strategy_df_ret_calc[[<span class="st">'Strategy Return'</span>]]</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>        strategy_df <span class="op">=</span> pd.merge(strategy_df, strategy_df_ret_calc, how<span class="op">=</span><span class="st">'left'</span>, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Strategy Return'</span>] <span class="op">=</span> strategy_df[<span class="st">'Strategy Return'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>        strategy_df.iloc[<span class="dv">0</span>, strategy_df.columns.get_loc(<span class="st">'Strategy Return'</span>)] <span class="op">=</span> np.nan</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Buy and Hold Return'</span>] <span class="op">=</span> strategy_df[<span class="st">'Close'</span>].pct_change()</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Strategy Cumulative Return'</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> strategy_df[<span class="st">'Strategy Return'</span>]).cumprod() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Buy and Hold Cumulative Return'</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> strategy_df[<span class="st">'Buy and Hold Return'</span>]).cumprod() <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>        strategy_df.iloc[<span class="dv">0</span>, strategy_df.columns.get_loc(<span class="st">'Strategy Cumulative Return'</span>)] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>        strategy_df.iloc[<span class="dv">0</span>, strategy_df.columns.get_loc(<span class="st">'Buy and Hold Cumulative Return'</span>)] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Strategy Values'</span>] <span class="op">=</span> initial_value <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> strategy_df[<span class="st">'Strategy Cumulative Return'</span>])</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>        strategy_df[<span class="st">'Buy and Hold Values'</span>] <span class="op">=</span> initial_value <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> strategy_df[<span class="st">'Buy and Hold Cumulative Return'</span>])</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>        strategy_df.index <span class="op">=</span> df.index</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>        non_neutral_df <span class="op">=</span> strategy_df[strategy_df[<span class="st">'Signal Updated'</span>] <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>        non_neutral_list <span class="op">=</span> non_neutral_df[<span class="st">'Signal Updated'</span>].tolist()</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>        strategy_cum_return <span class="op">=</span> strategy_df[<span class="st">'Strategy Cumulative Return'</span>].iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>        results.append({</span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>            <span class="op">**</span>weight_dict,</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Last Signal'</span>: non_neutral_list[<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Strategy Cumulative Return'</span>: strategy_cum_return,</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Buy and Hold Cumulative Return'</span>: buy_and_hold_cum_return</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> strategy_cum_return <span class="op">&gt;</span> best_cum_return:</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>            best_cum_return <span class="op">=</span> strategy_cum_return</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>            best_weights <span class="op">=</span> weight_dict</span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>            best_strategy_df <span class="op">=</span> strategy_df</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> best_cum_return <span class="op">&gt;</span> buy_and_hold_cum_return:</span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> plot:</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>        plt.plot(best_strategy_df.index, best_strategy_df[<span class="st">'Close'</span>], label<span class="op">=</span><span class="st">'Close Price'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> date, row <span class="kw">in</span> best_strategy_df.iterrows():</span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>            signal <span class="op">=</span> row[<span class="st">'Signal Updated'</span>]</span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> signal <span class="op">==</span> <span class="dv">1</span> <span class="kw">or</span> signal <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>:</span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a>                plt.plot(</span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a>                    date,</span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a>                    row[<span class="st">'Close'</span>],</span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a>                    marker<span class="op">=</span><span class="st">'^'</span> <span class="cf">if</span> signal <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">'v'</span>,</span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a>                    markersize<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a>                    markerfacecolor<span class="op">=</span><span class="st">'green'</span> <span class="cf">if</span> signal <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">'red'</span>,</span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a>                    markeredgewidth<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a>                    markeredgecolor<span class="op">=</span><span class="st">'black'</span></span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a>        plt.scatter([], [], marker<span class="op">=</span><span class="st">'^'</span>, color<span class="op">=</span><span class="st">'g'</span>, label<span class="op">=</span><span class="st">'Buy Signal'</span>)</span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a>        plt.scatter([], [], marker<span class="op">=</span><span class="st">'v'</span>, color<span class="op">=</span><span class="st">'r'</span>, label<span class="op">=</span><span class="st">'Sell Signal'</span>)</span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Best Strategy Signals - Cumulative Return: </span><span class="sc">{:.2%}</span><span class="st">'</span>.<span class="bu">format</span>(best_cum_return))</span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Price'</span>)</span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">True</span>)</span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a>        plt.plot(</span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a>            best_strategy_df.index,</span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a>            best_strategy_df[<span class="st">'Strategy Values'</span>],</span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">'blue'</span>,</span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="st">'Strategy'</span></span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a>        plt.plot(</span>
<span id="cb23-108"><a href="#cb23-108" aria-hidden="true" tabindex="-1"></a>            best_strategy_df.index,</span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a>            best_strategy_df[<span class="st">'Buy and Hold Values'</span>],</span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">'red'</span>,</span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="st">'Buy and Hold'</span></span>
<span id="cb23-112"><a href="#cb23-112" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb23-113"><a href="#cb23-113" aria-hidden="true" tabindex="-1"></a>        plt.axhline(y<span class="op">=</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb23-114"><a href="#cb23-114" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="ss">f'Strategy vs. Buy and Hold Cumulative Returns</span><span class="ch">\n</span><span class="ss">Strategy: </span><span class="sc">{</span>best_cum_return<span class="sc">:.2%}</span><span class="ss">, Buy and Hold: </span><span class="sc">{</span>buy_and_hold_cum_return<span class="sc">:.2%}</span><span class="ss">'</span>)</span>
<span id="cb23-115"><a href="#cb23-115" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb23-116"><a href="#cb23-116" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">True</span>)</span>
<span id="cb23-117"><a href="#cb23-117" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb23-118"><a href="#cb23-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-119"><a href="#cb23-119" aria-hidden="true" tabindex="-1"></a>        sorted_weights <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">sorted</span>(best_weights.items(), key<span class="op">=</span><span class="kw">lambda</span> item: item[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)}</span>
<span id="cb23-120"><a href="#cb23-120" aria-hidden="true" tabindex="-1"></a>        indicators <span class="op">=</span> <span class="bu">list</span>(sorted_weights.keys())</span>
<span id="cb23-121"><a href="#cb23-121" aria-hidden="true" tabindex="-1"></a>        weights <span class="op">=</span> <span class="bu">list</span>(sorted_weights.values())</span>
<span id="cb23-122"><a href="#cb23-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-123"><a href="#cb23-123" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb23-124"><a href="#cb23-124" aria-hidden="true" tabindex="-1"></a>        bars <span class="op">=</span> plt.barh(indicators, weights, color<span class="op">=</span><span class="st">'skyblue'</span>)</span>
<span id="cb23-125"><a href="#cb23-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> bar, weight <span class="kw">in</span> <span class="bu">zip</span>(bars, weights):</span>
<span id="cb23-126"><a href="#cb23-126" aria-hidden="true" tabindex="-1"></a>            plt.text(bar.get_width(), bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>, <span class="ss">f'</span><span class="sc">{</span>weight<span class="sc">:.3f}</span><span class="ss">'</span>, va<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb23-127"><a href="#cb23-127" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Weights'</span>)</span>
<span id="cb23-128"><a href="#cb23-128" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Optimized Weights for Indicators'</span>)</span>
<span id="cb23-129"><a href="#cb23-129" aria-hidden="true" tabindex="-1"></a>        plt.gca().invert_yaxis()</span>
<span id="cb23-130"><a href="#cb23-130" aria-hidden="true" tabindex="-1"></a>        plt.grid(axis<span class="op">=</span><span class="st">'x'</span>)</span>
<span id="cb23-131"><a href="#cb23-131" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb23-132"><a href="#cb23-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-133"><a href="#cb23-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results_df, best_weights</span>
<span id="cb23-134"><a href="#cb23-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-135"><a href="#cb23-135" aria-hidden="true" tabindex="-1"></a>optimization_results, best_weights <span class="op">=</span> optimize_weights_and_evaluate(df, pivot_ta_rating_df, indicators, plot<span class="op">=</span><span class="va">True</span>)</span></code><button title="Panoya Kopyala" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Yukarıdaki fonksiyon, belirtilen teknik analiz indikatörleri için optimal ağırlıkları bulmak ve bu ağırlıkları kullanarak bir alım-satım stratejisini değerlendirmek amacıyla tasarlanmıştır. Fonksiyon, al-tut stratejisini alt edecek en iyi ağırlıkları bulana kadar çalışır. İşlem adımlarını özetlemek gerekirse:</p>
<ul>
<li>Ağırlıkların Belirlenmesi: Rastgele ağırlıklar oluşturulur ve bunlar normalleştirilerek (toplamı 1 yapılarak) her bir indikatöre atanır.</li>
<li>Stratejinin Uygulanması: Her bir indikatör için ağırlıklı ortalama hesaplanır ve bu değerler belirlenen sinyal kategorilerine (sat, nötr, al) dönüştürülür. Sinyaller güncellenir ve bu sinyallerle strateji değerlendirilir.</li>
<li>Getirilerin Hesaplanması: Sinyallere göre strateji getirisi ve al-tut getirisi hesaplanır. Her iki strateji için de kümülatif getiriler hesaplanır ve başlangıç değeri (örneğin, 100 birim) ile çarpılarak strateji ve al-tut için değerler belirlenir.</li>
<li>En İyi Ağırlıkların Bulunması: Her denemede bulunan strateji getirisi kaydedilir ve en yüksek getiriye sahip olan ağırlıklar en iyi ağırlıklar olarak belirlenir.</li>
<li>Sonuçların Görselleştirilmesi: En iyi strateji için getiriler ve sinyaller grafiklerle gösterilir. Ayrıca, en iyi ağırlıkların hangi indikatörler için olduğunu gösteren bir çubuk grafik oluşturulur.</li>
</ul>
<p>Örneğe göre görsel çıktıları aşağıdaki gibidir.</p>
<p><img src="imgs/img_4.png" class="img-fluid"></p>
<p><img src="imgs/img_5.png" class="img-fluid"></p>
<p><img src="imgs/img_6.png" class="img-fluid"></p>
<p><code>optimization_results</code> çıktısına göre ilk denemede bulduğunu görebiliriz.</p>
<p><img src="imgs/img_7.PNG" class="img-fluid"></p>
<p>En uygun ağırlıkları görsel yerine <code>best_weights</code> çıktısında da görebiliriz.</p>
<p><img src="imgs/img_8.PNG" class="img-fluid"></p>
<p><em>Gelecek içeriklerde görüşmek dileğiyle.</em></p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopyalandı");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopyalandı");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>